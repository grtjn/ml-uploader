!function(){"use strict";angular.module("ml.uploader",["ml.common","ui.bootstrap"])}(),function(){"use strict";function e(){return window.File&&window.FileList&&window.FileReader}function l(l){return{restrict:"E",replace:!0,transclude:!0,scope:{multiple:"@",collection:"@mlCollection",fileList:"=uploadFileList"},link:function(t,n,o,a){function i(e){e.stopPropagation(),e.preventDefault(),"dragenter"===e.type||"dragover"===e.type?u.addClass("hover"):u.removeClass("hover")}function r(e){e.preventDefault(),e.stopPropagation(),console.log("drop files",e),e=e.originalEvent;var l=e.target.files||e.dataTransfer.files,n=l.length;for(i(e);n--;)s(l[n]);t.$apply()}function s(e){console.log("processing file",e);var n=e.name.substr(e.name.lastIndexOf(".")+1),o=l.sendFile(e,{uri:e.name.replace(/ /g,""),category:"content",collection:t.collection});o.ext=n,t.files.push(o)}if(t.files=t.fileList||[],!e())throw"ml-uloader - HTML5 file upload not supported by this browser";t.multiple=t.multiple&&"true"===t.multiple,n=angular.element(n),n.append('<div style="width:0;height:0;overflow:hidden"><input type="file" name="_hidden_uploader_file" '+(t.multiple?"multiple":"")+"></div>");var d=n.find('input[type="file"]'),u=n.find(".ml-dropzone");u.on("click",function(e){console.log("dz click"),d.click(),e.stopPropagation()}).on("drop",r).on("dragenter dragleave dragover",i),d.on("change",r),jQuery("html").on("drop",function(e){return e.preventDefault(),console.log("document drop",e),!1})},template:'<div class="ml-upload"><div class="ml-dropzone"><div class="notes" ng-transclude ng-hide="files.length"></div><ul class="ml-upload-file-list list-unstyled" ng-show="files.length"><li ng-repeat="f in files" class="ml-upload-file" ng-attr-file-extension="{{f.ext}}" ng-class="{ \'ml-upload-done\': f.done, \'ml-upload-error\': f.failed }" ng-attr-title="{{f.errorStatus || f.name}}"><span class="ml-upload-file-name">{{ f.name }}</span><span class="ml-upload-file-progress"><span class="ml-upload-progress-value">{{ f.value }}%</span><span class="ml-upload-progress-bar" ng-style="{ width: f.value + \'%\' }">&nbsp;</span></span></li></ul></div></div>'}}angular.module("ml.uploader").directive("mlUpload",l),l.$injector=["mlUploadService"]}(),function(){"use strict";function e(e,l,t){function n(){e.$$phase||e.$apply()}var o={},a={};return a.value=0,a.done=!1,a.name="unkown",a.failed=!1,a.update=function(e){this.updated=Date.now(),console.log("update progress",this),e&&(this.value=e,this.done=100===e),n(this)},a.error=function(e){console.log("setting error",e),this.failed=!0,this.errorStatus=e,n(this)},o.sendFile=function(e,t){var n=Object.create(a),o="binary";return n.name=e.name,console.log("sending file"),/text/.test(e.type)?o="text":/xml/.test(e.type)?o="xml":/json/.test(e.type)&&(o="json"),l.updateDocument(e,angular.extend({uri:e.name,format:o},t)).then(function(e){console.log("added document to grade"),n.done=!0,n.update(100)}),n},o}angular.module("ml.uploader").factory("mlUploadService",e),e.$inject=["$rootScope","MLRest","$http"]}();